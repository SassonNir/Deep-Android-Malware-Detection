import os, random
import subprocess


def run_droid_former(inp, c, out):
    output_dir = out + "/" + c.split(".")[0]
    os.makedirs(output_dir, exist_ok=True)
    command = "python3 ./droidbot/start.py -a " + inp + os.path.sep + c + " -o " + output_dir + " -policy dfs_greedy -grant_perm -is_emulator -ignore_ad -keep_env -count 5 -timeout 300"
    try:
        output = subprocess.run(command, shell=True, timeout=150, check=True)
    except subprocess.TimeoutExpired:
        print("Timeout of 2.5 minutes exceeded, stopping droidbot.")
    except subprocess.CalledProcessError as e:
        print("droidbot failed with return code", e.returncode, e.output)


# input folder
inp = './Input'

# output folder
out = './Output'

# run files from input folder
for c in os.listdir(inp):
    try:
        run_droid_former(inp, c, out)
    except:
        continue
