FROM nagadomi/torch7:latest
WORKDIR /app
COPY . .

RUN apt-get update
RUN apt-get -y install android-sdk-build-tools
RUN apt-get -y install wget
# Install APKTool
RUN wget https://bitbucket.org/iBotPeaches/apktool/downloads/apktool_2.7.0.jar
RUN mv apktool_2.7.0.jar /usr/local/bin/apktool.jar
RUN wget https://raw.githubusercontent.com/iBotPeaches/Apktool/master/scripts/linux/apktool
RUN mv apktool /usr/local/bin/apktool
RUN chmod +x /usr/local/bin/apktool.jar
RUN chmod +x /usr/local/bin/apktool
# Install uber-apk-signer
RUN wget https://github.com/patrickfav/uber-apk-signer/releases/download/v1.2.1/uber-apk-signer-1.2.1.jar
RUN mv uber-apk-signer-1.2.1.jar /usr/local/bin/uber-apk-signer.jar
RUN chmod +x /usr/local/bin/uber-apk-signer.jar

RUN DEBIAN_FRONTEND=noninteractive TZ=Etc/UTC apt-get -y install tzdata
# RUN apt-get update && \
#     apt-get install -y software-properties-common && \
#     add-apt-repository -y ppa:deadsnakes/ppa && \
#     apt-get update && \
#     apt install -y python3.10 python3-pip
RUN apt update -y && \
    apt-get install -y build-essential checkinstall  libreadline-gplv2-dev  libncursesw5-dev  libssl-dev  libsqlite3-dev tk-dev libgdbm-dev libc6-dev libbz2-dev libffi-dev zlib1g-dev && \
    cd /usr/src && \
    sudo wget https://www.python.org/ftp/python/3.10.9/Python-3.10.9.tgz && \
    sudo tar xzf Python-3.10.9.tgz && \
    cd Python-3.10.9 && \
    sudo ./configure --enable-optimizations && \
    sudo make altinstall

RUN python3.10 -m pip install bidict tqdm

WORKDIR /shared

ENTRYPOINT ["tail", "-f", "/dev/null"]